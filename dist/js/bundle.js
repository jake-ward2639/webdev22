addEventListener("load",(e=>{let t;showTopNav=()=>{let e=document.querySelector("#topNav");"topnav"===e.className?e.className+=" responsive":e.className="topnav"},changeContent=e=>{try{document.querySelector("#"+document.querySelector(".active").id.replace("_link","")+"_section").style.display="none",document.querySelector(".active").classList.remove("active")}catch{document.querySelector("#Thanks_section").style.display="none"}document.querySelector("#"+e+"_section").style.display="Block";try{document.querySelector("#"+e+"_link").classList.add("active")}catch{}},reportError=e=>{document.querySelector("#report_error").textContent=e},showCFBox=()=>{"default"==document.querySelector("#conditionFoundA").value?(document.querySelector("#conditionFoundB").style.display="none",document.querySelector("#conditionFoundC").style.display="none"):"alive"==document.querySelector("#conditionFoundA").value?(document.querySelector("#conditionFoundB").style.display="inline-block",document.querySelector("#conditionFoundC").style.display="none"):"dead"==document.querySelector("#conditionFoundA").value&&(document.querySelector("#conditionFoundB").style.display="none",document.querySelector("#conditionFoundC").style.display="inline-block")},getLocation=()=>{success=e=>{let o=e.coords.latitude,n=e.coords.longitude;loadMap(o,n),t=o+" "+n},error=e=>{switch(e.code){case e.PERMISSION_DENIED:alert("You must ENABLE your location to submit a sighting");break;case e.POSITION_UNAVAILABLE:alert("Your Location is unavailable.");break;case e.TIMEOUT:alert("The request to get your location timed out.");break;case e.UNKNOWN_ERROR:alert("An unknown error occurred.")}},navigator.geolocation?navigator.geolocation.getCurrentPosition(success,error):alert("Geolocation not supported")},loadMap=(e,o)=>{let n=L.map("map").setView([e,o],13);L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(n);let a=L.marker([e,o]).addTo(n);a.dragging.enable(),a.bindPopup("<b>Location of Sighting<br><br>"+e+" "+o).openPopup(),a.on("dragend",(e=>{let o=a.getLatLng();a.setPopupContent("<b>Location of Sighting<br><br>"+o.lat+" "+o.lng),t=o.lat.toString()+" "+o.lng.toString()}))},submitSighting=()=>{const e=(new Date).getTime()+"."+document.querySelector("#imageToSubmit").files.item(0).name.split(".").pop();let o="";"alive"==document.querySelector("#conditionFoundA").value&&"default"!=document.querySelector("#conditionFoundB").value?o=document.querySelector("#conditionFoundA").value+": "+document.querySelector("#conditionFoundB").value:"dead"==document.querySelector("#conditionFoundA").value&&"default"!=document.querySelector("#conditionFoundC").value&&(o=document.querySelector("#conditionFoundA").value+": "+document.querySelector("#conditionFoundC").value),fetch("https://jw1448.brighton.domains/save_the_pangolin_api",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({username:document.querySelector("#username").value,conditionFound:o,notes:document.querySelector("#notes").value,locationOfSighting:t,imageName:e})}).then((e=>((e.status="400")?reportError(" Please make sure all mandatory fields are filled in and you are submitting an jpg or png file"):(e.status="500")&&reportError(" There was a server error, please try again later"),e.json()))).then((t=>{console.log(t),t.hasOwnProperty("id")&&uploadImage(e)})).catch((e=>{console.error}))},uploadImage=e=>{let t=document.querySelector("#imageToSubmit").files[0],o=new File([t],e,{type:t.type}),n=new FormData;n.append("sightingImage",o),fetch("https://jw1448.brighton.domains/save_the_pangolin_api/upload",{method:"POST",body:n,redirect:"follow"}).then((e=>e.text())).then((e=>{console.log(e);let t=JSON.parse(e);JSON.stringify(t).includes('"status":true')&&changeContent("Thanks")})).catch(console.error)},checkOfflineRequests=()=>{if(navigator.onLine){const e=localStorage.getItem("requests"),t=JSON.parse(e);if(t.length>0){const e=JSON.parse(localStorage.getItem(t[0]));fetch("https://jw1448.brighton.domains/save_the_pangolin_api",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({username:e.username,conditionFound:e.conditionFound,notes:e.notes,locationOfSighting:e.locationOfSighting,imageName:e.imageName})}).then((e=>("201"!=e.status&&(localStorage.removeItem(t[0]),t.shift(),localStorage.setItem("requests",JSON.stringify(t))),e.json()))).then((o=>{console.log(o);let n=new Image;n.src=e.image;let a=new FormData;var r,c,i;(r=n.src,c=e.imageName,i=n.type,fetch(r).then((function(e){return e.arrayBuffer()})).then((function(e){return new File([e],c,{type:i})}))).then((function(e){a.append("sightingImage",e),fetch("https://jw1448.brighton.domains/save_the_pangolin_api/upload",{method:"POST",body:a,redirect:"follow"}).then((e=>e.text())).then((e=>{console.log(e)})).catch(console.error),localStorage.removeItem(t[0]),t.shift(),localStorage.setItem("requests",JSON.stringify(t))}))})).catch((e=>{console.error}))}}},navigator.serviceWorker.register("./sw.js",{scope:"./"});const o=localStorage.getItem("formState");if(o){const e=JSON.parse(o);changeContent(e.activePage),document.querySelector("#username").value=e.username,document.querySelector("#conditionFoundA").value=e.conditionFoundA,document.querySelector("#conditionFoundB").value=e.conditionFoundB,document.querySelector("#conditionFoundC").value=e.conditionFoundC,document.querySelector("#notes").value=e.notes}else changeContent("Upload");localStorage.getItem("requests")||localStorage.setItem("requests","[]"),showCFBox(),getLocation();const n=document.querySelector("#Examples_section");fetch("https://jw1448.brighton.domains/save_the_pangolin_api?mostRecent=5",{method:"GET",redirect:"follow"}).then((e=>e.json())).then((e=>{for(const t of e.sightings){let e={method:"GET",redirect:"follow"};fetch("https://jw1448.brighton.domains/save_the_pangolin_api/download?imageName="+t.imageName,e).then((e=>e.blob())).then((e=>{const o=window.URL||window.webkitURL;let a=document.createElement("img");a.src=o.createObjectURL(e),n.appendChild(a);let r=document.createElement("p"),c=document.createTextNode("Submitted by "+t.username);r.appendChild(c),n.appendChild(r),r=document.createElement("p"),c=document.createTextNode("The pangolin was found "+t.conditionFound.replace(/([A-Z])/g," $1").trim().toLowerCase()),r.appendChild(c),n.appendChild(r),t.notes&&(r=document.createElement("p"),c=document.createTextNode("Additional notes:"),r.appendChild(c),n.appendChild(r),r=document.createElement("p"),c=document.createTextNode(t.notes),r.appendChild(c),n.appendChild(r)),r=document.createElement("p"),c=document.createTextNode("The location of the sighting was "+t.locationOfSighting),r.appendChild(c),n.appendChild(r),n.appendChild(document.createElement("br"))})).catch((e=>console.log("error",e)))}})).catch((e=>console.log("error",e))),document.querySelector("#submitSighting").addEventListener("click",(e=>{if(0==document.querySelector("#imageToSubmit").files.length)reportError("Select a file to submit");else if(navigator.onLine)submitSighting();else{const e=localStorage.getItem("requests"),o=JSON.parse(e),n=new Date;let a="request"+n.getTime();o.push(a),localStorage.setItem("requests",JSON.stringify(o));const r=n.getTime()+"."+document.querySelector("#imageToSubmit").files.item(0).name.split(".").pop();let c="";"alive"==document.querySelector("#conditionFoundA").value&&"default"!=document.querySelector("#conditionFoundB").value?c=document.querySelector("#conditionFoundA").value+": "+document.querySelector("#conditionFoundB").value:"dead"==document.querySelector("#conditionFoundA").value&&"default"!=document.querySelector("#conditionFoundC").value&&(c=document.querySelector("#conditionFoundA").value+": "+document.querySelector("#conditionFoundC").value);let i="";const l=document.querySelector("#imageToSubmit").files[0],d=new FileReader;d.onloadend=function(){i=d.result;const e=JSON.stringify({username:document.querySelector("#username").value,conditionFound:c,notes:document.querySelector("#notes").value,locationOfSighting:t,imageName:r,image:i});localStorage.setItem(a,e)},d.readAsDataURL(l)}})),document.querySelector("#conditionFoundA").addEventListener("change",(e=>{showCFBox()})),window.onpagehide=()=>{const e=JSON.stringify({activePage:document.querySelector(".active").id.replace("_link",""),username:document.querySelector("#username").value,conditionFoundA:document.querySelector("#conditionFoundA").value,conditionFoundB:document.querySelector("#conditionFoundB").value,conditionFoundC:document.querySelector("#conditionFoundC").value,notes:document.querySelector("#notes").value});localStorage.setItem("formState",e)},setInterval(checkOfflineRequests,5e3)}));